<!doctype html>
<html>
    <head>
        <title>FRC #7589 | Scouting</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="./assets/app.css" rel="stylesheet">
        <link href="./manifest.json" rel="manifest">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet"/>

        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js" type="text/javascript"></script>
        <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js" type="text/javascript"></script>
        <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js" type="text/javascript"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11" type="text/javascript"></script>
        
        <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js" type="text/javascript"></script>
        <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-analytics.js" type="text/javascript"></script>
        <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js" type="text/javascript"></script>
        <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-remote-config.js" type="text/javascript"></script>
        <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js" type="text/javascript"></script>
        <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-messaging.js" type="text/javascript"></script>
    </head>
    <body class="p-5">
        <!--Top Bar-->
        <div class="fixed top-0 left-0 w-full h-14 md:h-16 bg-blue-600 z-30 py-1.5 px-3 sm:px-3.5">
            <div class="max-w-4xl mx-auto h-full flex items-center justify-between">
                <div class="relative pb-3.5 pr-1" onclick="showPage('teamIndexScreen')">
                    <h1 class="md:text-2xl text-xl text-blue-50">FRC #7589</h1>
                    <span class="absolute bottom-0 text-white">Scouting</span>
                </div>
            </div>
        </div>

        <!--Contents-->
        <div class="max-w-4xl mx-auto mt-14 md:mt-16">
            <!-- Team index-->
            <div class="w-full space-y-3 hidden" id="teamIndexScreen">
                <button 
                    class="inline-flex justify-center items-center space-x-1.5 rounded-md border border-transparent bg-indigo-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
                    onclick="updateSetting()">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 hidden md:block">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M10.343 3.94c.09-.542.56-.94 1.11-.94h1.093c.55 0 1.02.398 1.11.94l.149.894c.07.424.384.764.78.93.398.164.855.142 1.205-.108l.737-.527a1.125 1.125 0 011.45.12l.773.774c.39.389.44 1.002.12 1.45l-.527.737c-.25.35-.272.806-.107 1.204.165.397.505.71.93.78l.893.15c.543.09.94.56.94 1.109v1.094c0 .55-.397 1.02-.94 1.11l-.893.149c-.425.07-.765.383-.93.78-.165.398-.143.854.107 1.204l.527.738c.32.447.269 1.06-.12 1.45l-.774.773a1.125 1.125 0 01-1.449.12l-.738-.527c-.35-.25-.806-.272-1.203-.107-.397.165-.71.505-.781.929l-.149.894c-.09.542-.56.94-1.11.94h-1.094c-.55 0-1.019-.398-1.11-.94l-.148-.894c-.071-.424-.384-.764-.781-.93-.398-.164-.854-.142-1.204.108l-.738.527c-.447.32-1.06.269-1.45-.12l-.773-.774a1.125 1.125 0 01-.12-1.45l.527-.737c.25-.35.273-.806.108-1.204-.165-.397-.505-.71-.93-.78l-.894-.15c-.542-.09-.94-.56-.94-1.109v-1.094c0-.55.398-1.02.94-1.11l.894-.149c.424-.07.765-.383.93-.78.165-.398.143-.854-.107-1.204l-.527-.738a1.125 1.125 0 01.12-1.45l.773-.773a1.125 1.125 0 011.45-.12l.737.527c.35.25.807.272 1.204.107.397-.165.71-.505.78-.929l.15-.894z" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>                      
                    <span>Change Setting</span>
                </button>
                <button 
                    id="tbaAddTeamBtn"
                    class="hidden inline-flex justify-center items-center space-x-1.5 rounded-md border border-transparent bg-indigo-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
                    onclick="addTeamFromTBA()">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 hidden md:block">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5m-9-6h.008v.008H12v-.008zM12 15h.008v.008H12V15zm0 2.25h.008v.008H12v-.008zM9.75 15h.008v.008H9.75V15zm0 2.25h.008v.008H9.75v-.008zM7.5 15h.008v.008H7.5V15zm0 2.25h.008v.008H7.5v-.008zm6.75-4.5h.008v.008h-.008v-.008zm0 2.25h.008v.008h-.008V15zm0 2.25h.008v.008h-.008v-.008zm2.25-4.5h.008v.008H16.5v-.008zm0 2.25h.008v.008H16.5V15z" />
                    </svg>                      
                    <span>Add Teams through Event(TBA)</span>
                </button>
                <button 
                    class="inline-flex justify-center items-center space-x-1.5 rounded-md border border-transparent bg-indigo-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
                    onclick="quickRecord()">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 hidden md:block">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v6m3-3H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>                                          
                    <span>Quick Record</span>
                </button>
                <h1 class="text-center text-2xl lg:text-4xl text-blue-800">Teams</h1>
                <div class="flex flex-col items-center justify-center w-full space-y-3" id="team-index">
                    <div class="h-screen w-full flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
                        </svg>                          
                    </div>
                </div>
                <button 
                    class="z-30 fixed bottom-3 right-3 rounded-full w-14 h-14 lg:w-16 lg:h-16 text-blue-200 bg-blue-700 flex items-center justify-center text-center text-3xl"
                    onclick="addTeam()">
                    <span class="mb-1 lg:mb-1">+</span>
                </button>
            </div>

            <!-- Show Team -->
            <div class="w-full space-y-3 hidden" id="teamViewScreen">
                <h1 class="text-center text-2xl lg:text-4xl text-blue-800">Team #<span id="teamID"></span></h1>
                <h2 class="text-center text-xl lg:text-2xl text-blue-800 italic">"<span id="teamName"></span>"</h2>
                <hr/>
                <p class="text-slate-400" id="teamInfo"></p>
                <hr/>
                <div class="flex flex-col items-center justify-center w-full space-y-3" id="teamRecordList">
                    <div class="h-screen w-full flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
                        </svg>                          
                    </div>
                </div>
                <button 
                    class="z-30 fixed bottom-3 right-3 rounded-full w-14 h-14 lg:w-16 lg:h-16 text-blue-200 bg-blue-700 flex items-center justify-center text-center text-3xl"
                    onclick="recordCreate()">
                    <span class="mb-1 lg:mb-1">+</span>
                </button>
            </div>

            <!-- Create Record -->
            <div class="w-full hidden" id="recordCreateScreen">
                <div class="shadow-lg">
                    <div class="sm:overflow-hidden sm:rounded-md">
                        <div class="space-y-4 bg-white px-4 py-5 sm:p-6" id="form_content">
                            
                        </div>
                        <input hidden id="team_id"/>
                    </div>
                    <div class="bg-gray-50 px-4 py-3 text-right sm:px-6">
                        <button onclick="recordSave()" type="button" class="inline-flex justify-center rounded-md border border-transparent bg-indigo-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none border-indigo-500 border-2 focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">Save</button>
                    </div>
                </div>
            </div>
        </div>

        <!--Error Mask-->
        <div class="h-screen w-screen bg-red-500 z-40 fixed top-0 left-0 flex-col items-center justify-center hidden" id="errorMask">
            <h1 class="text-center text-3xl text-red-200" id="error-title">Error!</h1>
            <p class="text-center text-lg text-red-200" id="error-message">message</p>
        </div>


        <!-- Utils -->
        <script>
            function _uuid() {
                var d = Date.now();
                if (typeof performance !== 'undefined' && typeof performance.now === 'function'){
                    d += performance.now(); //use high-precision timer if available
                }
                return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
                    var r = (d + Math.random() * 16) % 16 | 0;
                    d = Math.floor(d / 16);
                    return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);
                });
            }

            function tba_available() {
                return typeof getConfig("tba_key")._value !== null;
            }
        </script>

        <!-- Firebase -->
        <script>
            // https://firebase.google.com/docs/web/setup#available-libraries
          
            // Your web app's Firebase configuration
            // For Firebase JS SDK v7.20.0 and later, measurementId is optional
            const firebaseConfig = {
              apiKey: "AIzaSyCQ5cg4VRFiVxeT6JQPKI1vd3kB938w_g0",
              authDomain: "frc-7589.firebaseapp.com",
              projectId: "frc-7589",
              storageBucket: "frc-7589.appspot.com",
              messagingSenderId: "283240547457",
              appId: "1:283240547457:web:ce55f744bc4b4d46653980",
              measurementId: "G-2EB11FYT18"
            };
          
            firebase.initializeApp(firebaseConfig);
            const analytics = firebase.analytics();
            const db = firebase.firestore();
            const remoteConfig = firebase.remoteConfig();
            const auth = firebase.auth();
            const messaging = firebase.messaging();

            db.settings({
                cacheSizeBytes: firebase.firestore.CACHE_SIZE_UNLIMITED
            });

            db.enablePersistence()
                .catch((err) => {
                    if (err.code == 'failed-precondition') {
                        // Multiple tabs open, persistence can only be enabled
                        // in one tab at a a time.
                        // ...
                    } else if (err.code == 'unimplemented') {
                        // The current browser does not support all of the
                        // features required to enable persistence
                        // ...
                    }
                });

            remoteConfig.settings.minimumFetchIntervalMillis = 3600000;

            remoteConfig.defaultConfig = {
                "tba_key": null,
                "parameters": "[{\"name\":\"[Auto]Cube Count\",\"type\":\"number\",\"alias\":\"auto_cube\"},{\"name\":\"[Auto]Cone Count\",\"type\":\"number\",\"alias\":\"auto_cone\"},{\"name\":\"Cube Count\",\"type\":\"number\",\"alias\":\"cube\"},{\"name\":\"Cone Count\",\"type\":\"number\",\"alias\":\"cone\"},{\"name\":\"Robot Design \",\"type\":\"textarea\",\"alias\":\"robotDesign\"},{\"name\":\"Drive Base\",\"type\":\"textarea\",\"alias\":\"driveBase\"},{\"name\":\"Note\",\"type\":\"textarea\",\"alias\":\"note\"}]",
                "formula": "((auto_cube+auto_cone*1.2)*0.7+(cone+cube)*0.3)",
                "eventKey": "2023casd"
            };

            messaging.usePublicVapidKey('BI3uCo1Esg_eHJOfq9iQcMCWzT6AeANuzHkBf-RcG0ZgsMF6eNaFZbp205s5is9vxjay7-rMeCim--Qascb1wqg');


            messaging.onMessage((payload) => {
                console.log('Message received. ', payload);
                // ...
            });

            function getConfig(key) {
                return remoteConfig.getValue(key);
            }

            function fetchSettings(silent = false) {
                remoteConfig.fetchAndActivate()
                .then(() => {
                    if(!silent) showMessage("config fetched");
                })
                .catch((err) => {
                    showMessage("FAILED to fetch config");
                });
            }

            function anonyLogin(silent = false) {
                auth.signInAnonymously()
                    .then(() => {
                        if(!silent) showMessage("login successful");
                    })
                    .catch((error) => {
                        var errorCode = error.code;
                        var errorMessage = error.message;
                        showMessage("login error");
                    });
            }

            function storeRecord(key, data) {
                db.collection("records").doc(key).set(data, { merge: true })
                .then(() => {
                    showMessage("Record successfully sotred!");
                })
                .catch((error) => {
                    console.error("Error writing document: ", error);
                });
            }

            async function getAllRecords(number = null) {
                const req = db.collection("records");
                var result;
                if(number != null) {
                    await req.where("team_number", "==", number).get()
                        .then((querySnapshot) => {
                            result = querySnapshot;
                        })
                        .catch((error) => {
                            console.error("FAILED to get records: ", error);
                        });
                } else {
                    await req.get().then((querySnapshot) => {
                        result = querySnapshot;
                    })
                    .catch((error) => {
                        console.error("FAILED to get records: ", error);
                    });
                }
                return result;
            }

            async function getTeams(number = null) {
                const req = db.collection("teams");
                var result;
                showMessage("Fetching teams");
                if(number != null) {
                    await req.doc(number).get()
                        .then((querySnapshot) => {
                            result = querySnapshot;
                        })
                        .catch((error) => {
                            showMessage("FAILED to get team: ", error);
                        });
                } else {
                    await req.get().then((querySnapshot) => {
                        result = querySnapshot;
                    })
                    .catch((error) => {
                        showMessage("FAILED to get teams: ", error);
                    });
                }
                return result;
            }

            function storeTeam(key, data, silent = false) {
                db.collection("teams").doc(key).set(data, { merge: true })
                    .then(() => {
                        if(!silent) showMessage("Team successfully store!");
                    })
                    .catch((error) => {
                        console.error("FAILED to store team: ", error);
                    });
            }

            function changeDBMode(online, silent = false) {
                if(online) {
                    db.enableNetwork().then(() => {
                        if(!silent) showMessage("mode: ONLINE");
                    });
                } else {
                    db.disableNetwork().then(() => {
                        if(!silent) showMessage("mode: OFFLINE");
                    });
                }
            }
        </script>

        <!-- Service Worker -->
        <script>
            if('serviceWorker' in navigator) {
                console.log('Registering service worker');
                try {
                    navigator.serviceWorker.register("./service-worker.js").then((reg) => {
                        messaging.useServiceWorker(reg);
                    });

                    messaging.requestPermission().then(function() {
                        messaging_token = localStorage.getItem("messaging_token");
                        if(messaging_token === null) {
                            messaging.getToken().then(function(currentToken) {
                                var id = currentToken.split(':')[0];
                                db.collection('pushUsers').doc(id).set({'token': currentToken});
                                localStorage.setItem("messaging_token", currentToken);
                            });
                        } else {
                            var id = ckv.split(':')[0];
                            db.collection('pushUsers').doc(id).set({'token': ckv});
                        }
                    }).catch(function(err) {
                        console.log('使用者未允許通知', err);
                    });
                } catch(e) {
                    console.warn('Failed to register service worker, err:' + e);
                }
            }
        </script>

        <!-- Event Listners -->
        <script>
            window.addEventListener('load', (event) => {
                anonyLogin(true);
                if('onLine' in navigator) {
                    changeDBMode(navigator.onLine, true);
                    if(navigator.onLine) fetchSettings(true);
                }
                getTeamIndex();
            });

            window.addEventListener('offline', () => { 
                changeDBMode(false);
            });

            window.addEventListener('online', () => { 
                changeDBMode(true);
                fetchSettings(true);
            });
        </script>

        <!-- UI -->
        <script>
            var last_page;

            function updateEleText(id, text) {
                document.getElementById(id).innerText = text;
            }

            function updateEleHTML(id, html) {
                document.getElementById(id).innerHTML = html;
            }

            function showMessage(title, top = false, after) {
                let timerInterval;

                console.log(title);

                Swal.fire({
                    title: title,
                    position: top ? 'top' : 'bottom',
                    timer: 1500,
                    timerProgressBar: true,
                    willClose: () => {
                        clearInterval(timerInterval);
                        after
                    },
                    showClass: {
                        popup: `
                        animate__animated
                        animate__fadeInUp
                        animate__faster
                        `
                    },
                    hideClass: {
                        popup: `
                        animate__animated
                        animate__fadeOutDown
                        animate__faster
                        `
                    },
                    customClass: {
                        container: 'p-1.5',
                        title: 'p-2.5 text-slate-50 text-base font-medium',
                        popup: 'rounded-md bg-slate-800'
                    },
                    padding: '0',
                    grow: 'row',
                    showConfirmButton: false,
                    showCloseButton: false,
                    backdrop: false,
                    heightAuto: false
                });
            }
        
            function showPage(name) {
                if(last_page != name) document.getElementById(name).classList.replace("hidden", "box");
                if(last_page != null && last_page != name) document.getElementById(last_page).classList.replace("box", "hidden");
                last_page = name;
            }
        </script>

        <!-- Actions -->
        <script>
            function getTeamIndex() {
                showPage("teamIndexScreen");
                if(tba_available()) {
                    document.getElementById("tbaAddTeamBtn").classList.remove("hidden");
                }
                getTeams().then((teams) => { 
                    if(!teams.empty) {
                        document.getElementById("team-index").innerHTML = "";
                        teams.forEach((team) => {
                            var team_info = team.data();
                            document.getElementById("team-index").innerHTML += '<div class="bg-blue-100 rounded-lg w-full p-3 lg:p-5 space-y-3" onclick="showTeam(\''+ team_info.team_number +'\')">' +
                                '<div><h1 class="text-xl xl:text-2xl">Team #' + team_info.team_number +'</h1><h2 class="xl:text-lg">'+ team_info.nickname +'</h2></div>'+
                                '<div class="flex items-center justify-between space-x-2"><div class="flex-1 bg-blue-200 rounded-lg flex flex-col p-4">' +
                                '<h3 class="text-lg lg:text-xl flex space-x-1.5 items-center"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z" /></svg><span>Rate:</span></h3>'+
                                '<p class="text-4xl font-bold text-center">'+ 0 +'</p></div>'+
                                '<div class="flex-1 bg-blue-200 rounded-lg flex flex-col p-4"><h3 class="text-lg lg:text-xl flex space-x-1.5 items-center"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z" /></svg><span>Records:</span></h3>'+
                                '<p class="text-4xl font-bold text-center">' + 0+ '</p></div></div></div>';
                        });
                    }
                });
            }

            function addTeam() {
                Swal.fire({
                    title: 'Enter Team Number',
                    input: 'number',
                    inputAttributes: {
                        autocapitalize: 'off'
                    },
                    showCancelButton: true,
                    confirmButtonText: 'Search',
                    showLoaderOnConfirm: true,
                    preConfirm: (number) => {
                        if('onLine' in navigator) {
                            if(!navigator.onLine) {
                                return {
                                    requireName: true,
                                    number: number
                                };
                            }
                        }
                        return axios.get("https://www.thebluealliance.com/api/v3/team/frc" + number, {
                                    headers: {
                                        "accept": "application/json",
                                        "X-TBA-Auth-Key": getConfig("tba_key")._value
                                    }
                                }).then(res => {
                                    if(res.status == 200) {
                                        return res.data;
                                    } else {
                                        Swal.showValidationMessage(
                                            `Request failed`
                                        );
                                    }
                                }).catch(error => {
                                    Swal.showValidationMessage(
                                        `Request failed: ${error}`
                                    );
                                });
                    },
                    allowOutsideClick: () => !Swal.isLoading()
                }).then((result) => {
                    if (result.isConfirmed) {
                        if(result.value.requireName) {
                            Swal.fire({
                                title: 'Enter Team Name',
                                input: 'text',
                                inputAttributes: {
                                    autocapitalize: 'off'
                                },
                                preConfirm: (input) => {
                                    return input;
                                },
                                showCancelButton: true,
                                confirmButtonText: 'Add',
                                showLoaderOnConfirm: true,
                            }).then((response) => {
                                if (response.isConfirmed) {
                                    Swal.fire({
                                        title: `Adding FRC # ${result.value.number}\n(aka "${response.value}") ?`,
                                        showCancelButton: true,
                                        confirmButtonText: 'Add',
                                    }).then((action) => {
                                        if(action.isConfirmed) storeTeam(result.value.number.toString(), {
                                            team_number: result.value.number.toString(),
                                            nickname: response.value,
                                            offline: true
                                        });
                                    });
                                }
                            });
                        } else {
                            Swal.fire({
                                title: `Adding FRC # ${result.value.team_number}\n(aka "${result.value.nickname}") ?`,
                                showCancelButton: true,
                                confirmButtonText: 'Add',
                            }).then((response) => {
                                console.table(result.value);
                                if(response.isConfirmed) storeTeam(result.value.team_number.toString(), result.value);
                            });
                        }
                    }
                });
            }
        
            function showTeam(number) {
                getTeams(number).then((team) => { 
                    if(!team.empty) {
                        var team_info = team.data();
                        showPage("teamViewScreen");
                        updateEleText("teamID", team_info.team_number);
                        updateEleText("teamName", team_info.nickname);
                        var html = "";
                        Object.keys(team_info).forEach((key) => {
                            if(key == "key" || key == "nickname" || key == "team_number") return;
                            html += '<li>' + key + ': ' + (key == "website" ? '<a href="' + team_info[key] + '">' + team_info[key] + '</a>' : team_info[key] ) + '</li>';
                        });
                        updateEleHTML("teamInfo", html);
                    }
                });
            }
        </script>
    </body>
</html>